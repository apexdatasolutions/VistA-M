SDECAR1A ;ALB/SAT - VISTA SCHEDULING RPCS ;MAR 15, 2017
 ;;5.3;Scheduling;**658**;Aug 13, 1993;Build 23
 ;
 Q
 ;
WLPC(ARDATA,ASDIEN) ;
 N PC,PC1,PCIEN
 S PC=""
 S PCIEN="" F  S PCIEN=$O(ARDATA(409.8544,PCIEN)) Q:PCIEN=""  D
 .Q:$P(PCIEN,",",2)'=ASDIEN
 .S PC1=""
 .S $P(PC1,"~~",1)=ARDATA(409.8544,PCIEN,.01,"E")    ;DATE ENTERED
 .S $P(PC1,"~~",2)=ARDATA(409.8544,PCIEN,2,"I")      ;PC ENTERED BY USER IEN
 .S $P(PC1,"~~",3)=ARDATA(409.8544,PCIEN,2,"E")      ;PC ENTERED BY USER NAME
 .S $P(PC1,"~~",4)=ARDATA(409.8544,PCIEN,3,"E")      ;ACTION
 .S $P(PC1,"~~",5)=ARDATA(409.8544,PCIEN,4,"E")      ;PATIENT PHONE
 .S PC=$S(PC'="":PC_"::",1:"")_PC1
 Q PC
 ;Returns multiple ptrs to SDEC APPOINTMENT (#409.84) by '|'
GETAPPTS(ARIEN) ;Get Multiple Appts Made field from SDEC APPT REQUEST file entry ARIEN
 N I,APPTS
 S I=0,APPTS=""
 Q:'$D(^SDEC(409.85,ARIEN,0)) ""
 I $D(^SDEC(409.85,ARIEN,2,0)) D
 .S I=0 F  S I=$O(^SDEC(409.85,ARIEN,2,I)) Q:'I  D
 ..S APPTS=APPTS_$S(APPTS]"":"|",1:"")_$P($G(^SDEC(409.85,ARIEN,2,I,0)),U,2)  ;this is correct
 ..;S APPTS=APPTS_$S(APPTS]"":"|",1:"")_$P($G(^SDEC(409.85,ARIEN,2,I,0)),U,1)   ;this is wrong
 Q APPTS
 ;
CHILDREN(ARIEN) ;Returns children SDEC APPT REQUEST pointers based on MULT APPTS MADE
 N CHILDS,MULT,REQ,SDI
 S CHILDS=""
 S SDI=0 F  S SDI=$O(^SDEC(409.85,+ARIEN,2,SDI)) Q:SDI'>0  D
 .S MULT=$P($G(^SDEC(409.85,+ARIEN,2,SDI,0)),U,1) ;this is correct
 .;S MULT=$P($G(^SDEC(409.85,+ARIEN,2,SDI,0)),U,2)  ;this is wrong
 .S CHILDS=$S(CHILDS'="":CHILDS_"|",1:"")_MULT
 Q CHILDS
 ;
ARDEMO(STR,DFN)  ;collect patient demographics and return in STR   ;alb/sat 658
 N PRIGRP,SDDEMO
 D PDEMO^SDECU3(.SDDEMO,DFN)  ;alb/sat 658 PDEMO moved to SDECU3
 S $P(STR,U,2)=SDDEMO("NAME")
 S $P(STR,U,4)=SDDEMO("DOB")
 S $P(STR,U,5)=SDDEMO("SSN")
 S $P(STR,U,6)=SDDEMO("GENDER")
 S (PRIGRP,$P(STR,U,26))=SDDEMO("PRIGRP")
 S $P(STR,U,27)=SDDEMO("ELIGIEN")
 S $P(STR,U,28)=SDDEMO("ELIGNAME")
 S $P(STR,U,29)=SDDEMO("SVCCONN")
 S $P(STR,U,30)=SDDEMO("SVCCONNP")
 S $P(STR,U,31)=SDDEMO("TYPEIEN")
 S $P(STR,U,32)=SDDEMO("TYPENAME")
 S $P(STR,U,38)=SDDEMO("PADDRES1")
 S $P(STR,U,39)=SDDEMO("PADDRES2")
 S $P(STR,U,40)=SDDEMO("PADDRES3")
 S $P(STR,U,41)=SDDEMO("PCITY")
 S $P(STR,U,42)=SDDEMO("PSTATE")
 S $P(STR,U,43)=SDDEMO("PCOUNTRY")
 S $P(STR,U,44)=SDDEMO("PZIP+4")
 S $P(STR,U,61)=SDDEMO("HPHONE")  ;alb/sat 658 change to HPHONE
 ;
 S $P(STR,U,68)=SDDEMO("HRN")
 S $P(STR,U,69)=SDDEMO("BADADD")
 S $P(STR,U,70)=SDDEMO("OPHONE")
 S $P(STR,U,71)=SDDEMO("NOK")
 S $P(STR,U,72)=SDDEMO("KNAME")
 S $P(STR,U,73)=SDDEMO("KREL")
 S $P(STR,U,74)=SDDEMO("KPHONE")
 S $P(STR,U,75)=SDDEMO("KSTREET")
 S $P(STR,U,76)=SDDEMO("KSTREET2")
 S $P(STR,U,77)=SDDEMO("KSTREET3")
 S $P(STR,U,78)=SDDEMO("KCITY")
 S $P(STR,U,79)=SDDEMO("KSTATE")
 S $P(STR,U,80)=SDDEMO("KZIP")
 S $P(STR,U,81)=SDDEMO("NOK2")
 S $P(STR,U,82)=SDDEMO("K2NAME")
 S $P(STR,U,83)=SDDEMO("K2REL")
 S $P(STR,U,84)=SDDEMO("K2PHONE")
 S $P(STR,U,85)=SDDEMO("K2STREET")
 S $P(STR,U,86)=SDDEMO("K2STREET2")
 S $P(STR,U,87)=SDDEMO("K2STREET3")
 S $P(STR,U,88)=SDDEMO("K2CITY")
 S $P(STR,U,89)=SDDEMO("K2STATE")
 S $P(STR,U,90)=SDDEMO("K2ZIP")
 S $P(STR,U,91)=SDDEMO("PCOUNTY")
 S $P(STR,U,92)=SDDEMO("PETH")
 S $P(STR,U,93)=SDDEMO("PRACE")
 S $P(STR,U,94)=SDDEMO("PMARITAL")
 S $P(STR,U,95)=SDDEMO("PRELIGION")
 S $P(STR,U,96)=SDDEMO("PTACTIVE")
 S $P(STR,U,97)=SDDEMO("PTADDRESS1")
 S $P(STR,U,98)=SDDEMO("PTADDRESS2")
 S $P(STR,U,99)=SDDEMO("PTADDRESS3")
 S $P(STR,U,100)=SDDEMO("PTCITY")
 S $P(STR,U,101)=SDDEMO("PTSTATE")
 S $P(STR,U,102)=SDDEMO("PTZIP")
 S $P(STR,U,103)=SDDEMO("PTZIP+4")
 S $P(STR,U,104)=SDDEMO("PTCOUNTRY")
 S $P(STR,U,105)=SDDEMO("PTCOUNTY")
 S $P(STR,U,106)=SDDEMO("PTPHONE")
 S $P(STR,U,107)=SDDEMO("PTSTART")
 S $P(STR,U,108)=SDDEMO("PTEND")
 S $P(STR,U,109)=SDDEMO("PCELL")
 S $P(STR,U,110)=SDDEMO("PPAGER")
 S $P(STR,U,111)=SDDEMO("PEMAIL")
 S $P(STR,U,112)=SDDEMO("PF_FFF")
 S $P(STR,U,113)=SDDEMO("PF_VCD")
 S $P(STR,U,114)=SDDEMO("PFNATIONAL")
 S $P(STR,U,115)=SDDEMO("PFLOCAL")
 S $P(STR,U,116)=SDDEMO("SUBGRP")
 S $P(STR,U,117)=(PRIGRP="GROUP 8")&(SDDEMO("SUBGRP")="g")
 S $P(STR,U,118)=SDDEMO("SIMILAR")
 Q
