YS108PRE ;HIOFO/FT - YS*5.01*108 PRE/POST-INIT ; 10/30/13 5:09pm
 ;;5.01;MENTAL HEALTH;**108**;Dec 30, 1994;Build 17
 ;
 ;Reference to XPDGREF and ^XTMP supported by DBIA #2433
 ;Reference to XPDMENU calls supported by DBIA #1157
 ;
MAIN ;Main entry
 D EN1,EN4
 D EN6,EN7
 Q
EN1 ;Change "F" and "M" nodes for MCMI3 entry in MH INSTRUMENT (#601)
 N YSERROR,YSSEX
 I $P($G(^YTT(601,246,0)),U,1)'="MCMI3" D  Q  ;is entry 246 = MCMI3
 .S YSERROR(1)="There is a problem updating the MCMI3 instrument definition in the"
 .S YSERROR(2)="MH INSTRUMENT file (#601). The internal entry number is different"
 .S YSERROR(3)="than what I expected. Please enter a Remedy ticket."
 .S YSERROR(4)="I'll proceed with the rest of the patch installation."
 .D EN^DDIOL(.YSERROR,"","")
 ; "F" and "M" nodes are the same values now
 D EN1A,EN2,EN3
 F YSSEX="F","M" D
 .;Y Desirability
 .S ^YTT(601,246,"S",3,YSSEX)="0^5^10^15^20^25^30^35^39^43^47^51^55^59^63^67^71^75^80^85^93^100"
 .;Z Debasement
 .S ^YTT(601,246,"S",4,YSSEX)="0^18^35^38^40^42^45^47^49^52^54^56^59^61^63^66^68^70^73^75^76^78^79^81^82^84^85^88^90^92^94^96^98^100"
 .;1 Schizoid
 .S ^YTT(601,246,"S",5,YSSEX)="0^12^24^36^48^60^62^64^66^68^70^72^75^78^81^85^89^93^97^101^105^109^112^115"
 .;2A Avoidant
 .S ^YTT(601,246,"S",6,YSSEX)="0^12^24^36^48^60^63^67^71^75^77^79^81^83^85^88^91^94^97^100^103^106^109^112^115"
 .;2B Depressive
 .S ^YTT(601,246,"S",7,YSSEX)="0^10^20^30^40^50^60^65^70^75^77^79^81^83^85^89^92^96^99^103^106^109^112^115"
 .;3 Dependent
 .S ^YTT(601,246,"S",8,YSSEX)="0^10^20^30^40^50^60^65^70^75^78^81^83^85^87^89^91^94^97^100^103^106^109^112^115"
 .;4 Histrionic
 .S ^YTT(601,246,"S",9,YSSEX)="0^4^8^12^16^20^24^28^32^36^40^44^48^51^54^57^60^63^66^69^72^75^79^83^88"
 .;5 Narcissistic
 .S ^YTT(601,246,"S",10,YSSEX)="0^5^10^15^20^25^30^35^40^44^48^52^56^60^63^67^71^75^85^89^93^97^101^105^110^115"
 .;6A Antisocial
 .S ^YTT(601,246,"S",11,YSSEX)="0^12^24^36^48^60^62^64^66^69^71^73^75^79^82^85^89^92^96^99^103^106^109^112^115"
 .;6B Sadistic
 .S ^YTT(601,246,"S",12,YSSEX)="0^12^24^36^48^60^62^64^66^68^69^70^71^72^73^74^75^78^80^83^85^90^95^100^105^110^115"
 .;7 Compulsive
 .S ^YTT(601,246,"S",13,YSSEX)="0^4^8^12^16^20^24^28^32^36^39^42^45^48^51^54^57^60^63^66^69^72^75^79^83^87"
 .;8A Negativistic
 .S ^YTT(601,246,"S",14,YSSEX)="0^10^20^30^40^50^60^62^64^66^68^70^72^75^77^79^81^83^85^89^93^97^101^105^110^115"
 .;8B Masochistic
 .S ^YTT(601,246,"S",15,YSSEX)="0^20^40^60^63^66^69^72^75^78^80^82^85^88^91^94^97^100^103^106^109^112^115"
 .;S Schizotypal
 .S ^YTT(601,246,"S",16,YSSEX)="0^20^40^60^62^64^66^67^68^69^70^71^72^73^74^75^78^81^85^90^95^99^103^107^111^115"
 .;C Borderline
 .S ^YTT(601,246,"S",17,YSSEX)="0^12^24^36^48^60^63^66^69^72^75^77^79^81^83^85^88^91^94^97^100^103^106^109^112^115"
 .;P Paranoid
 .S ^YTT(601,246,"S",18,YSSEX)="0^15^30^45^60^61^63^64^66^67^69^70^72^73^75^77^79^81^83^85^90^95^100^105^110^115"
 .;A Anxiety Disorder
 .S ^YTT(601,246,"S",19,YSSEX)="0^20^40^60^75^77^79^81^83^85^87^89^91^94^97^100^103^106^109^112^115"
 .;H Somatoform Disorder
 .S ^YTT(601,246,"S",20,YSSEX)="0^15^30^45^60^62^64^66^68^70^72^73^74^75^80^85^100^115"
 .;N Bipolar
 .S ^YTT(601,246,"S",21,YSSEX)="0^12^24^36^48^60^63^66^69^72^75^80^85^90^95^100^105^110^115"
 .;D Dysthymic Disorder
 .S ^YTT(601,246,"S",22,YSSEX)="0^12^24^36^48^60^62^64^66^69^72^75^78^80^82^85^91^97^103^109^115"
 .;B Alcohol Dependence
 .S ^YTT(601,246,"S",23,YSSEX)="0^20^40^60^63^67^71^75^77^80^83^85^88^91^95^99^103^107^111^115"
 .;T Drug Dependence
 .S ^YTT(601,246,"S",24,YSSEX)="0^20^40^60^63^67^71^75^76^77^78^79^81^83^85^90^95^100^105^110^115"
 .;R Post-Traumatic Stress
 .S ^YTT(601,246,"S",25,YSSEX)="0^15^30^45^60^62^63^65^66^68^69^71^73^75^77^79^81^83^85^95^105^115"
 .;SS Thought Disorder
 .S ^YTT(601,246,"S",26,YSSEX)="0^15^30^45^60^62^64^66^67^68^69^70^71^72^73^74^75^79^82^85^93^100^108^115"
 .;CC Major Depression
 .S ^YTT(601,246,"S",27,YSSEX)="0^15^30^45^60^65^70^75^78^81^85^87^89^91^93^95^97^99^101^103^106^109^112^115"
 .;PP Delusional Disorder
 .S ^YTT(601,246,"S",28,YSSEX)="0^30^60^62^65^68^70^72^75^80^85^90^95^100^105^110^115"
 Q
EN1A ;change SCALE NAME (601.01, .05) of IEN 1 from "V Validity" to "V Invalidity"
 S $P(^YTT(601,246,"S",1,0),U,2)="V Invalidity"
 S ^YTT(601,246,"S","C","V Invalidity",1)=""
 K ^YTT(601,246,"S","C","V Validity")
 Q
EN2 ;Create new nodes for Inconsistency scale (W)
 N DA,DIK,YSCHECK,YSERROR
 I $P($G(^YTT(601,246,0)),U,1)'="MCMI3" Q
 S YSCHECK=$G(^YTT(601,246,"S",29,0))
 I YSCHECK'="",YSCHECK'="29^W Inconsistency" D  Q
 .S YSERROR(1)="There is a problem adding the new 'W Inconsistency' scale to the"
 .S YSERROR(2)="MH INSTRUMENT file (#601) for MCMI3. Please enter a Remedy ticket."
 .S YSERROR(4)="I'll proceed with the rest of the patch installation."
 .D EN^DDIOL(.YSERROR,"","")
 S ^YTT(601,246,"S",29,0)="29^W Inconsistency"
 S ^YTT(601,246,"S",29,"K",1,0)="1;T-4;F^1;F-4;T^8;F-141;T^13;T-66;F^13;F-66;T^15;T-133;F^20;T-112;F^20;F-112;T^22;T-83;F^24;F-151;T^25;T-56;F"
 S ^YTT(601,246,"S",29,"K",2,0)="25;F-56;T^27;F-92;T^32;T-80;F^35;T-84;F^35;F-84;T^39;T-118;F^39;F-118;T^41;F-166;T^44;T-86;F^44;F-150;T"
 S ^YTT(601,246,"S",29,"K",3,0)="48;T-92;F^49;T-146;F^52;F-152;T^55;F-130;T^57;F-80;T^61;F-76;T^62;F-86;T^68;F-162;T^69;T-99;F^70;F-104;T"
 S ^YTT(601,246,"S",29,"K",4,0)="72;F-142;T^74;F-107;T^77;T-131;F^91;T-136;F^91;F-136;T^108;T-135;F^109;F-164;T^123;F-128;T^129;T-173;F"
 S ^YTT(601,246,"S",29,"K",5,0)="133;T-145;F^147;F-149;T^160;T-164;F^160;F-173;T"
 S ^YTT(601,246,"S","B",29,29)=""
 S ^YTT(601,246,"S","C","W Inconsistency",29)=""
 Q
EN3 ;Update disclosure (scale X) adjustments
 S ^YTT(601,246,"S",2,"M")="0^2^3^5^6^8^9^11^12^14^15^17^18^20^21^23^24^26^27^29^30^32^33^35^36^37^37^38^39^39^40^41^41^42^43^43^44^45^45^46^47^47^48^49^49^50^51^51^52^53^53^54^55^55^56^57^57^58^59^59^60^61^61^62^63^63^64"
 S ^YTT(601,246,"S",2,"MS")="65^65^66^67^67^68^69^69^70^71^71^72^73^73^74^74^75^75^75^76^76^76^77^77^77^78^78^78^79^79^79^80^80^80^81^81^81^82^82^82^83^83^84^84^85^85^86^86^87^88^88^89^89^90^90^91^92^92^93^93^94^94^95^95^96^96^97^97^98^99"
 Q
EN4 ;instrument names & iens match
 N YSIEN,YSLINE,YSNAME,YSTEXT
 D EN4C(155,"ASSIST-WHOv3")
 F YSLINE=1:1 S YSTEXT=$T(NAME+YSLINE) Q:$P(YSTEXT,";",3)=""  D
 .S YSIEN=$P(YSTEXT,";",3),YSNAME=$P(YSTEXT,";",4)
 .D EN4B(YSIEN,YSNAME)
 .I $P($G(^YTT(601.71,YSIEN,0)),U,1)=YSNAME Q
 .I '$D(^YTT(601.71,YSIEN,0)) D EN4A(YSIEN,YSNAME) Q
 .D EN4C(YSIEN,YSNAME)
 Q
EN4A(YSX,YSY) ;add instrument zero node & B x-ref placeholders
 Q:$G(YSX)'>0
 Q:$G(YSY)=""
 S $P(^YTT(601.71,YSX,0),U,1)=YSY
 S ^YTT(601.71,"B",YSY,YSX)=""
 Q
EN4B(YSX,YSY) ;rename instrument to avoid duplicates
 N YSARR,YSDA,YSFDA,YSTEXT
 Q:$G(YSX)'>0
 Q:$G(YSY)=""
 S YSDA=0
 F  S YSDA=$O(^YTT(601.71,"B",YSY,YSDA)) Q:'YSDA  D
 .Q:YSDA=YSX
 .S YSTEXT="ZZ"_$P($G(^YTT(601.71,YSDA,0)),U,1)
 .S YSFDA(601.71,YSDA_",",.01)=YSTEXT
 .S YSFDA(601.71,YSDA_",",10)="N"
 .D UPDATE^DIE("","YSFDA","YSARR")
 Q
EN4C(YSX,YSY) ;change instrument name
 N YSARR,YSFDA
 Q:$G(YSX)'>0
 Q:$G(YSY)=""
 S YSFDA(601.71,YSX_",",.01)=YSY
 D UPDATE^DIE("","YSFDA","YSARR")
 Q
NAME ;;601.71 IEN;601.71 .01 VALUE
 ;;102;BRS
 ;;142;CEMI
 ;;143;SNQ
 ;;144;CSI
 ;;145;FAD
 ;;146;IMRA
 ;;147;FOCI
 ;;148;PCL-5
 ;;150;SST-VOI
 ;;151;SST-VOF
 ;;167;KATZ ADL
 ;;192;STOP
 ;;193;MDQ
 ;;194;CAM
 ;;195;PSOCQ
 ;;196;PSS
 ;;197;DBAS
 ;;198;WHOQOL-BREF
 ;;199;ISI
 ;;201;RLS
 ;;203;QOLIE-10
 ;;205;SOCRATES 8A
 ;;206;SOCRATES 8D
 ;;207;ASSIST-NIDA
 ;;208;BSL-23
 ;;209;DERS
 ;;210;KTZADL
 ;;211;YBOCSII
 ;;212;YBOCSII SYMPTOM LIST
 ;;213;SIP-2L
 ;;214;QOLIE-31
 ;;215;CCSA-DSM5
 ;;216;SMEQ
 ;;217;AAQ-SA
 ;;218;CIWA-AR-
 ;;;
 Q
EN6 ;Clean up entries
 N YSIEN
 ;MH TESTS AND SURVEYS (601.71)
 ;delete entries over ien 218.
 S YSIEN=218   ;218 is the highest IEN
 F  S YSIEN=$O(^YTT(601.71,YSIEN)) Q:'YSIEN!(YSIEN>99999)  D DELETE(601.71,YSIEN,.01,"@")
 ;
 ;MH QUESTIONS (601.72)
 F YSIEN=4555,5460,6520,6588,6737,6739,6745,6759,6766,6767,6772,6795,6938,6948,6958,6968,6975,6978,6988,6998,7133,7144,7147,7294 D DELETE(601.72,YSIEN,.01,"@")
 K ^YTT(601.72,7133,1,3,0)
 ;
 ;MH INTRODUCTIONS (601.73)
 ;no cleanup
 ;
 ;MH RESPONSE TYPES (601.74)
 ;no cleanup.
 ;
 ;MH CHOICES (601.75)
 ;CHOICE TEXT which is an IDENTIFIER has changed.
 ;The KIDS build will add the correct value.
 F YSIEN=1192,1457,1865,2305,2885,3253,3352,3420,3519,3528 D DELETE(601.75,YSIEN,3,"@")
 ;
 ;MH CHOICETYPES (601.751)
 F YSIEN=100005:1:100010,100013,100016,100017,100023:1:100028,100031,100034,100035,100041:1:100046 D DELETE(601.751,YSIEN,.01,"@")
 F YSIEN=100049,100052,100053,100059:1:100064,100067,100070,100071 D DELETE(601.751,YSIEN,.01,"@")
 ;
 ;MH INSTRUMENT CONTENT (601.76)
 F YSIEN=83:1:85,370,5933,5934,5936,6431,6499,6643,6644,6682,6684,6690,6704,6711,6712,6717,6883,6893,6903,6913,6923,6933,6943,6920,6740,7089,7092,7239,7272,7273 D DELETE(601.76,YSIEN,.01,"@")
 ;
 ;MH SKIPPED QUESTIONS (601.79)
 F YSIEN=2:1:23,29:1:57,81,111,112,172:1:177,461,538:1:589,825:1:833,852:1:860,1008:1:1061,1065:1:1071,1076:1:1140,1150:1:1173,1183:1:1242,1285:1:1299,1329,1451:1:1521,1622:1:1692 D DELETE(601.79,YSIEN,.01,"@")
 ;
 ;MH SECTIONS (601.81)
 F YSIEN=3:1:19,212,247,257,260:1:268,364,365,368:1:371,378:1:393,396:1:415,417,420:1:422,425:1:438,450,476,952:1:967,967:1:983 D DELETE(601.81,YSIEN,.01,"@")
 F YSIEN=1322:1:1331,1345,1354,1363,1372,1381,1390,1399,1408,1417,1426 D DELETE(601.81,YSIEN,.01,"@")
 F YSIEN=1429:1:1431,1435,1438,1441,1444,1447,1460,1461,1464,1466,1468,1471:1:1473,1481,1652 D DELETE(601.81,YSIEN,.01,"@")
 ;
 ;MH RULES (601.82)
 F YSIEN=47:1:58,68:1:73,97,196,197,220,241,271:1:277,279,280,282:1:291,293:1:296,299,300,302:1:307,320,337 D DELETE(601.82,YSIEN,.01,"@")
 ;Delete value from INDEX QUESTION (#2)
 F YSIEN=172:1:174 D DELETE(601.82,YSIEN,1,"@")
 ;
 ;MH INSTRUMENTRULES (601.83)
 F YSIEN=16,18:1:22,75,76,82,106,110,111,113:1:144,146,173:1:182,203,209:1:211,220,221,233,256:1:261,267,268,275,280,281 D DELETE(601.83,YSIEN,.01,"@")
 F YSIEN=302,303,306:1:313,326,343,410,431 D DELETE(601.83,YSIEN,.01,"@")
 ;
 ;MH SCALEGROUPS (601.86)
 ;Delete value in GROUP SEQUENCE (#3)
 F YSIEN=53:1:57,63,97:1:99,118,125,126,132,218,220,221,245 D DELETE(601.86,YSIEN,.01,"@")
 ;
 ;MH SCALES (601.87)
 F YSIEN=203:1:209,232,330,278,333:1:337,348:1:364,419,454:1:459,462,495,496,499,587,588,613,897,906,907,940,941,982 D DELETE(601.87,YSIEN,.01,"@")
 ;
 ;MH DISPLAY (601.88)
 ;Delete ALL entries and repopulate with KIDS
 S YSIEN=0
 F  S YSIEN=$O(^YTT(601.88,YSIEN)) Q:'YSIEN  D DELETE(601.88,YSIEN,.01,"@")
 ;
 ;MH CHOICEIDENTIFIERS (601.89)
 ;no cleanup
 ;
 ;MH SCORING KEYS (601.91)
 F YSIEN=1:1:98,100:1:110,112:1:142,165,166,213:1:356,358:1:371,374,376,377,379:1:497,502:1:571,642,644:1:678 D DELETE(601.91,YSIEN,.01,"@")
 F YSIEN=5173:1:5239,5999:1:6082,6141:1:6143,6145,6146,7433:1:7435,7437:1:7443,7449:1:7458,7531:1:7535,7551:1:7555,7557:1:7560,7564 D DELETE(601.91,YSIEN,.01,"@")
 F YSIEN=7614,7626:1:7631,7923:1:7956,7969:1:7972,7981:1:8000,8112:1:8117,8264,8265,8474,8476,8479:1:8482,8487:1:8490,8495:1:8519,8522 D DELETE(601.91,YSIEN,.01,"@")
 F YSIEN=8535.8537,8538,8540,8541,8543,8544,8546:1:8550,8552:1:8611,8689,8870:1:8873,9112:1:9136,9151:1:9230,9500,9509,9541,9654:1:9674 D DELETE(601.91,YSIEN,.01,"@")
 ;
 ;MH REPORTS (601.93)
 F YSIEN=5,6,7,9,10,17:1:20,27,59,61,64,81,139,147 D DELETE(601.93,YSIEN,.01,"@")
 K ^YTT(601.93,138,1,74,0)
 F YSIEN=25:1:27 K ^YTT(601.93,139,1,YSIEN,0)
 Q
DELETE(YSFN,YSDA,YSFLD,YSVAL) ;Delete field value or entire entry
 ; Input:  YSFN = file #
 ;         YSDA = entry #
 ;        YSFLD = field #
 ;        YSVAL = value
 ;
 N YSARR,YSFDA
 S YSFDA(YSFN,YSDA_",",YSFLD)=YSVAL
 D UPDATE^DIE("","YSFDA","YSARR")
 Q
EN7 ;Put obsolete options out of order
 N YSOPT,YSTEXT
 S YSTEXT="No new GAFs allowed, DSM 5 released"
 F YSOPT="YSGAF ERROR","YSGAF CLINIC ENTRY","YSGAF SINGLE PT" D
 .D OUT^XPDMENU(YSOPT,YSTEXT)
 S YSTEXT="Please use the MHA GUI to enter an ASI",YSOPT="YSAS ADD/EDIT ASI"
 D OUT^XPDMENU(YSOPT,YSTEXT)
 S YSTEXT="ASIs are no longer transmitted."
 F YSOPT="YSAS ASI ADD INDIVIDUAL","YSAS ASI ADD RANGE" D
 .D OUT^XPDMENU(YSOPT,YSTEXT)
 S YSTEXT="Inactivated by YS*5.01*108"
 F YSOPT="YSDIAGE" D
 .D OUT^XPDMENU(YSOPT,YSTEXT)
 Q
PRETRAN ;Pre-Transportation entry point
 ;Copy the MH CHOICETYPE (601.751) entries into the transport global
 N YSLOOP
 S YSLOOP=0
 F  S YSLOOP=$O(^YTT(601.751,YSLOOP)) Q:'YSLOOP!(YSLOOP>999999)  D
 .S @XPDGREF@(601.751,YSLOOP)=$G(^YTT(601.751,YSLOOP,0))
 Q
POST751 ;enter all MH CHOICETYPE (601.751) entries
 N N,DIK
 S N=0
 F  S N=$O(^XTMP("XPDI",XPDA,"TEMP",601.751,N)) Q:N'>0  D
 .S ^YTT(601.751,N,0)=^XTMP("XPDI",XPDA,"TEMP",601.751,N)
 S DIK="^YTT(601.751," D IXALL^DIK
 ;Kill existing indexes and re-index
 K ^YTT(601.76,"B"),^YTT(601.76,"AC"),^YTT(601.76,"AE"),^YTT(601.76,"AD"),^YTT(601.76,"AF")
 S DIK="^YTT(601.76," D IXALL^DIK
 K ^YTT(601.71,"B")
 S DIK="^YTT(601.71," D IXALL^DIK
 K ^YTT(601.79,"B"),^YTT(601.79,"AC"),^YTT(601.79,"AD"),^YTT(601.79,"AE"),^YTT(601.79,"AF")
 S DIK="^YTT(601.79," D IXALL^DIK
 K ^YTT(601.81,"B"),^YTT(601.81,"AC")
 S DIK="^YTT(601.81," D IXALL^DIK
 K ^YTT(601.83,"B"),^YTT(601.83,"AC"),^YTT(601.83,"C"),^YTT(601.83,"AD")
 S DIK="^YTT(601.83," D IXALL^DIK
 K ^YTT(601.86,"B"),^YTT(601.86,"AC"),^YTT(601.86,"AD")
 S DIK="^YTT(601.86," D IXALL^DIK
 K ^YTT(601.93,"B"),^YTT(601.93,"C")
 S DIK="^YTT(601.93," D IXALL^DIK
 K ^YTT(601.72,"B"),^YTT(601.72,"ACT")
 S DIK="^YTT(601.72," D IXALL^DIK
 K ^YTT(601.75,"B"),^YTT(601.75,"C"),^YTT(601.75,"AC"),^YTT(601.75,"AU")
 S DIK="^YTT(601.75," D IXALL^DIK
 K ^YTT(601.87,"B"),^YTT(601.87,"AC"),^YTT(601.87,"AD")
 S DIK="^YTT(601.87," D IXALL^DIK
 K ^YTT(601.91,"B"),^YTT(601.91,"AC")
 S DIK="^YTT(601.91," D IXALL^DIK
 Q
